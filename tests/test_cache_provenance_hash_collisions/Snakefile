"""Test provenance hash collision handling with caching.

This workflow creates a workflow where multiple jobs have the SAME provenance hash
(same rule, same shell command, no params that differ).

Expected behavior on first run with cores=3:
1. Job 1 is marked as computing the hash, starts execution
2. Jobs 2 and 3 try to mark same hash -> filtered out by scheduler
3. Job 1 completes, releases mark and stores to cache
4. Job 2 marks hash, fetches from cache (cache hit), releases mark
5. Job 3 marks hash, fetches from cache (cache hit), releases mark

This tests that:
- Marks prevent concurrent execution of jobs with same cache entry
- Marks are properly released on cache hits
- Sequential execution works correctly (no rapid bouncing)
"""
shell.executable("bash")

rule all:
    input:
        expand("output_{i}.txt", i=range(3))

rule generate:
    output:
        "output_{i}.txt"
    cache: True
    shell:
        "echo 'test' > {output}"
